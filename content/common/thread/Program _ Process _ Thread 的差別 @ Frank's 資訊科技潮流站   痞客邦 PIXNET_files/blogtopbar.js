window.requestTimeout=function(e,t){"use strict";function a(){var o=(new Date).getTime(),r=o-n;r>=t?e.call():i.value=window.requestAnimFrame(a)}if(!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame))return window.setTimeout(e,t);var n=(new Date).getTime(),i={};return i.value=window.requestAnimFrame(a),i},window.clearRequestTimeout=function(e){return window.cancelAnimationFrame?window.cancelAnimationFrame(e.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(e.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(e.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(e.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(e.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(e.value):clearTimeout(e)},window.requestAnimFrame=function(){"use strict";return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),function(e){"use strict";var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};e.fn.replaceTpl=function(e,a){var n=/\#\{\$(.+?)\}/g,i=t;return e.replace(n,function(e){return String(a[e.replace(n,"$1")]).replace(/[&<>"'\/]/g,function(e){return i[e]})})}}(jQuery),function(e){"use strict";e.support.cssProperty=function(e){for(var t=",Webkit,Moz,O,ms,Khtml".split(","),a=t.length,n=!1,i=0;a>i&&(i&&(e=e.charAt(0).toUpperCase()+e.substr(1)),!(n=t[i]+e in document.body.style));i++);return n}}(jQuery),function(e,t,a){"use strict";var n=function(){if(-1===navigator.userAgent.indexOf("MSIE"))return!1;var e=parseInt(navigator.userAgent.split("MSIE")[1].split(";")[0]);return 9>=e}();e.fn.Search=function(i){var o=this,r=i.jqSearch,s=i.jqSearchInput,c=i.jqSearchBtn,l=i.jqSearchReset,d=i.jqSearchSuggestion,u={show:i.suggestionShowClass,item:i.suggestionItemClass,selected:i.suggestionSelectedClass};this.searchSuggestion=function(){var a={kwdCached:{},kwdTpl:{item:i.suggestionItemTpl,mark:"<mark>$1</mark>"}},n=d;return a.getKwd=function(t){if(t=e.trim(String(t)),!t.length)return a.hideKwd(),void 0;var i=a.setKwdCount();a.kwdCached[t]?a.showKwd(a.kwdCached[t],t):!function(i){e.ajax({url:"//emma.pixnet.cc/mainpage/keywords/search.json?sort=count&limit=10&q="+t,dataType:"jsonp"}).done(function(e){var o=e.keywords;e.error||(o.length?(a.kwdCached[t]=o,i===n.data("kwd-counter")&&a.showKwd(o,t)):a.hideKwd())})}(i)},a.setKwdCount=function(){var e,t=n.data("kwd-counter")||0;return n.data("kwd-counter",t+1),e=n.data("kwd-counter")},a.hideKwd=function(e){e&&n.empty(),n.removeClass(u.show)},a.showKwd=function(t,i){for(var o,r=0,s=t.length,c="",l=e("<ul />"),d=new RegExp("("+i.replace(/(\W)/g,"\\$1")+")","gi");s>r;r+=1)o=l.html(e.fn.replaceTpl(a.kwdTpl.item,{keyword:t[r]})).children("li"),o.html(o.html().replace(d,a.kwdTpl.mark)),c+=l.html();n.html(c).addClass(u.show),c=l=o=null},a.fillKwd=function(e){var t=n.find("."+u.selected);t.length&&(e=e||t.text(),s.val(e))},a.selectKwd=function(e){if(27===e)return a.hideKwd(),s.val(t.unescape(s.data("kwd"))),void 0;n.addClass(u.show);var i=n.find("li"),o=i.length,r=i.filter("."+u.selected).index(),c=38===e?-1:1,l=(r+c)%o;i.length||a.getKwd(s.val()),i.removeClass(u.selected).eq(l).addClass(u.selected),a.fillKwd()},a}(),this.checkSearchVal=function(){""===s.val()?l.hide():l.show()},this.validateForm=function(){return 0!==s[0].value.length},this.submitCount=function(e,n){var i,o=new Image(1,1),r=function(){t.clearRequestTimeout(i),a.location.href=n};o.src=e,o.onload=r,o.onerror=r,i=t.requestTimeout(r,500)},this.submit=function(){var e,t=c.find("button").eq(0),a=t.val(),n=t.data("counterlink"),i=s[0].maxLength;i<s[0].value.length&&s.val(s.val().slice(0,i)),e=r.attr("action")+"?"+r.serialize()+"&search="+a,e&&o.submitCount(n,e)},this.init=function(){if(c.on("click.switch","button",function(){var t=e(this);0!==t.index()&&c.prepend(t)}),i.autoFocusBtn){var p=location.pathname.split(/^\//)[1],h=c.find("button").filter('[value="'+p+'"]');t.setTimeout(function(){h.trigger("click.switch")},0)}r.on("submit.check",function(e){e.preventDefault(),o.validateForm()&&o.submit()}),s.on({"input.reset change.reset":o.checkSearchVal,"input.kwd change.kwd focus.kwd":function(){o.searchSuggestion.getKwd(s.val())}}),i.suggestionKeyboard&&s.on({"keydown.kwdCtrl input.kwdCtrl":function(e){var a=e.keyCode,i=s.val();switch(a){case 27:case 38:case 40:e.preventDefault(),o.searchSuggestion.selectKwd(a);break;default:n&&o.searchSuggestion.getKwd(i),s.data("kwd",t.escape(i))}}}),l.on("click.reset",function(e){e.preventDefault(),s[0].value="",o.checkSearchVal(),o.searchSuggestion.hideKwd()}),d.on("mouseenter",function(){s.blur()}).on("mouseenter.selectKwd","."+u.item,function(){e(this).siblings().removeClass(u.selected).end().addClass(u.selected)}).on("mouseleave.selectKwd","."+u.item,function(){e(this).removeClass(u.selected)}).on("click.suggestion","."+u.item,function(){o.searchSuggestion.fillKwd(),o.searchSuggestion.hideKwd(),r.submit()}),e(a).on("click.suggestion",function(t){0===e(t.target).parents().filter(r).length&&o.searchSuggestion.hideKwd()})}}}(jQuery,window,document),function(e,t,a,n,i){"use strict";e(function(){var o,r,s,c,l,d,u,p=function(){if(-1===navigator.userAgent.indexOf("MSIE"))return!1;var e=parseInt(navigator.userAgent.split("MSIE")[1].split(";")[0]);return 9>=e}(),h="is-active";o=function(e){return a.getElementById(e)},u={},u.win=e(t),u.doc=e(a),u.topbar=function(){var t=e(o("topbar")),a=t.find(".topbar__search"),n=t.find(".topbar__nav");return{topbar:t,search:a,announce:t.find(".topbar__announce"),relatedArticle:t.find(".topbar__related-article__block"),nav:n,searchContainer:n.find(".topbar__search-container"),notification:n.find(".topbar__notification"),user:n.find(".topbar__user"),lang:n.find(".topbar__lang")}}(),s=function(e){var a=e.jqAnnounce,n=a.find("a"),i=e.hideClass,o={index:0,total:n.length,duration:e.duration};this.carousel=function(){!function e(){t.setTimeout(function(){var t=o.index;o.index=(t+1)%o.total,n.eq(t).add(n.eq(o.index)).toggleClass(i),e()},o.duration)}()},this.init=function(){this.carousel()}},d=function(){function n(e,t,a){x&&(a=A),ga("topbarAarticlesTracker.send","event",e,t,a)}function i(e){var t,a=r(e),i=b+a,o=h.eq(e).find("a");y||(y=!0,n("TOP BAR displayed","displayed")),T[e]||(T[e]=!0,x?n("TAB_"+g.articlesType+"_displayed","TAB_"+a):n("TAB displayed",i)),x?n("TAB_"+g.articlesType+"_imps","TAB_"+a):n("TAB imps",i),c("TOPBAR 成效","imps",a,f);for(var l=x&&"固定"===g.articlesType?5:v[C].showNum,d=0;l>d;d++)t=d+1,x?n("推薦文章_"+g.articlesType+"_imps","TAB_"+a+"_"+t):n("推薦文章_imps",i,"content_"+t),s("imps",a,o.eq(d).attr("href"))}function o(e){try{var t=e.split("//")[1].split(".")[0],a=e.split("/post/")[1].split("?")[0].split("-")[0];return{author:t,id:a}}catch(n){return!1}}function r(e){return k[e]||(k[e]=p.eq(e).data("tab-name")),k[e]}function s(e,t,a){var n=o(a);n&&c("TOPBAR 推薦文章成效",e,t,n)}function c(e,t,a,n){var i={action:t+": "+(w||_)+" "+a,label:n.author+" "+n.id};_piq.push(["trackEvent",e,i.action,i.label])}function l(){function t(){for(var e=[],t=[{name:"賞櫻住宿還有位",click_url:"https://www.hotelscombined.com/Hotels/Search?destination=place%3aAsakusa&checkin=2016-04-01&checkout=2016-04-02&Rooms=1&adults_1=2&languageCode=TW&currencyCode=TWD&a_aid=132653&label=TOPBAR",title:"[東京-隅田公園] 欣賞晴空塔與櫻花河畔的絕佳飯店旅館~",file:"http://pic.pimg.tw/misspixnet/1456908433-3419335769.jpg"},{name:"賞櫻住宿還有位",click_url:"https://www.hotelscombined.com/Hotels/Search?destination=place%3aShinjuku&checkin=2016-04-04&checkout=2016-04-05&Rooms=1&adults_1=2&languageCode=TW&currencyCode=TWD#destination=place:Shinjuku&radius=0km&checkin=2016-04-04&checkout=2016-04-05&Rooms=1&adults_1=2&pageSize=15&pageIndex=0&sort=Popularity-desc&showSoldOut=false&lowRate=2000&highRate=5000&scroll=88.66667055200656&HotelID=&mapState=expanded%3D0&a_aid=132653&label=TOPBAR",title:"[新宿-御苑] 日本全國賞櫻名所TOP 1旁的飯店推薦！",file:"http://pic.pimg.tw/misspixnet/1456908433-2299869932.jpg"},{name:"賞櫻住宿還有位",click_url:"https://www.hotelscombined.com/Hotels/Search?destination=place:Lake_Kawaguchi&radius=5km&checkin=2016-04-01&checkout=2016-04-02&Rooms=1&adults_1=2&pageSize=15&pageIndex=0&sort=Popularity-desc&showSoldOut=false&HotelID=&mapState=expanded%3D0#destination=place:Lake_Kawaguchi&radius=5km&checkin=2016-04-01&checkout=2016-04-02&Rooms=1&adults_1=2&pageSize=15&pageIndex=0&sort=ConsumerRating-desc&showSoldOut=false&lowRate=2000&highRate=7000&scroll=0&HotelID=&mapState=expanded%3D0&a_aid=132653&label=TOPBAR",title:"[富士-河口湖] 在富士山旁的日式旅館欣賞震撼櫻花海",file:"http://pic.pimg.tw/misspixnet/1456908433-3978997656.jpg"},{name:"賞櫻住宿還有位",click_url:"https://www.hotelscombined.com/Hotels/Search?destination=place%3aOsaka&resultID=0&checkin=2016-04-01&checkout=2016-04-02&Rooms=1&adults_1=2&languageCode=TW&currencyCode=TWD#destination=place:Osaka&radius=0km&checkin=2016-04-01&checkout=2016-04-02&Rooms=1&adults_1=2&pageSize=15&pageIndex=0&sort=ConsumerRating-desc&showSoldOut=false&lowRate=0&highRate=4000&scroll=0&HotelID=&mapState=expanded%3D0&a_aid=132653&label=TOPBAR",title:"[大阪城公園] 走出飯店就能抵達關西地區的賞櫻秘境～",file:"http://pic.pimg.tw/misspixnet/1456908432-1095340710.jpg"},{name:"賞櫻住宿還有位",click_url:"https://www.hotelscombined.com/Hotels/Search?destination=place%3aHakodate&resultID=0&checkin=2016-04-27&checkout=2016-04-28&Rooms=1&adults_1=2&languageCode=TW&currencyCode=TWD&a_aid=132653&label=TOPBAR",title:"[函館-五稜郭公園] 五稜郭塔上眺望腳下櫻花！",file:"http://pic.pimg.tw/misspixnet/1456908431-78854242.jpg"},{name:"賞櫻住宿還有位",click_url:"https://www.hotelscombined.com/Hotels/Search?destination=place%3aHakone&resultID=0&checkin=2016-04-04&checkout=2016-04-05&Rooms=1&adults_1=2&languageCode=TW&currencyCode=TWD#destination=place:Hakone&radius=0km&checkin=2016-04-04&checkout=2016-04-05&Rooms=1&adults_1=2&pageSize=15&pageIndex=0&sort=Popularity-desc&showSoldOut=false&lowRate=2000&highRate=5000&scroll=88.4444498603728&HotelID=&mapState=expanded%3D0",title:"[函館-五稜郭公園] 五稜郭塔上眺望腳下櫻花！",file:"http://pic.pimg.tw/misspixnet/1456908431-78854242.jpg"},{name:"賞櫻住宿還有位",click_url:"https://www.hotelscombined.com/Hotels/Search?destination=place%3aKyoto&resultID=1&checkin=2016-04-04&checkout=2016-04-05&Rooms=1&adults_1=2&languageCode=TW&currencyCode=TWD#destination=place:Kyoto&radius=0km&checkin=2016-04-04&checkout=2016-04-05&Rooms=1&adults_1=2&pageSize=15&pageIndex=0&sort=Popularity-desc&showSoldOut=false&lowRate=2000&highRate=7000&scroll=89.33333580582237&HotelID=&mapState=expanded%3D0&a_aid=132653&label=TOPBAR",title:"[函館-五稜郭公園] 五稜郭塔上眺望腳下櫻花！",file:"http://pic.pimg.tw/misspixnet/1456908431-78854242.jpg"},{name:"賞櫻住宿還有位",click_url:"https://www.hotelscombined.com/Hotels/Search?destination=place%3aKumamoto&resultID=0&checkin=2016-04-04&checkout=2016-04-05&Rooms=1&adults_1=2&languageCode=TW&currencyCode=TWD&a_aid=132653&label=TOPBAR",title:"[函館-五稜郭公園] 五稜郭塔上眺望腳下櫻花！",file:"http://pic.pimg.tw/misspixnet/1456908431-78854242.jpg"}],a=0;5>a;a++){var n=Math.floor(Math.random()*(5-a));e.push(t[n]),t.splice(n,1)}return e}var a=function(){var e=new RegExp("[\\?&]demo_ad_no=([^&#]*)"),t=e.exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}(),n=e("body").data("blog-site-category-id"),i=e(".article-head > .title").data("site-category-id"),o=function(e){for(var t='<li class="topbar__related-article__cat" data-tab-name="廣告"><div class="topbar__related-article__txt topbar__related-article__txt--hot">'+e[0].name+'</div><div class="topbar__related-article__showcase"><ul class="topbar__related-article-list">',a='<li class="topbar__related-article"><a href="{{ URL }}" target="_blank"><div class="topbar__related-article__img"><img src="{{ THUMB }}" onerror="this.remove()"></div><div class="topbar__related-article__title">{{ TITLE }}</div></a></li>',n=0;n<e.length;n++)t+=a.replace("{{ URL }}",e[n].click_url).replace("{{ TITLE }}",e[n].title).replace("{{ THUMB }}",e[n].file);t+="</ul></div></li>",u.topbar.relatedArticle.find(".topbar__related-article__showcase-block").before(t)};x?(o(t()),p=u.topbar.relatedArticle.find(".topbar__related-article__cat")):(e.ajaxSetup({cache:!0}),e.ajax({url:"https://falcon.pixanalytics.com/ad/json/1754",dataType:"json",data:{version:2,ad_limit:5,demo_ad_no:a,blog_category:n,article_category:i}}).done(function(e){!e.error&&e.ad_slots[0]&&e.ad_slots[0].ad_num&&(o(e.ad_slots[0].ad_list),p=u.topbar.relatedArticle.find(".topbar__related-article__cat"))}),e.ajaxSetup({cache:!1}))}!function(e,t,a,n,i,o,r){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,o=t.createElement(a),r=t.getElementsByTagName(a)[0],o.async=1,o.src=n,r.parentNode.insertBefore(o,r)}(t,a,"script","//www.google-analytics.com/analytics.js","ga");var d,p=u.topbar.relatedArticle.find(".topbar__related-article__cat"),h=u.topbar.relatedArticle.find(".topbar__related-article-list"),m=e("#body-div"),f=o(location.href),g=u.topbar.relatedArticle.data(),w=g.travelCity,_=g.articlesCategory,b="TAB_"+g.articlesType+"_",k=[!1,!1,!1,!1,!1,!1],v={small:{showNum:3},large:{showNum:5}},y=!1,T=[!1,!1,!1,!1,!1,!1],C=u.win.width()-1024>=0?"large":"small",x=u.topbar.topbar.parent().data("in-test"),A="固定"===g.articlesType?"固定_test 2A":"固定_test 2B";x?ga("create","UA-69603077-4","auto",{name:"topbarAarticlesTracker"}):ga("create","UA-71151682-1","auto",{name:"topbarAarticlesTracker"}),ga("topbarAarticlesTracker.set","contentGroup1",w),ga("topbarAarticlesTracker.set","contentGroup2",_),ga("topbarAarticlesTracker.send","pageview"),x&&n("TOP BAR imps","imps"),this.init=function(){l(),u.topbar.relatedArticle.on("mouseenter",".topbar__related-article__cat",function(){var t=e(this).index(".topbar__related-article__cat");d=t,i(t)}),u.topbar.relatedArticle.on("click","a:not(.topbar__related-article__cat-name)",function(){var t=e(this).parent(),a=t.parent().index(".topbar__related-article-list"),i=r(a),o=b+i,l=t.index();x?n("推薦文章_"+g.articlesType+"_click","TAB_"+i+"_"+(l+1)):n("推薦文章_click",o,"content_"+(l+1)),c("TOPBAR 成效","click",i,f),s("click",i,e(this).attr("href"))}),e("#mib-video-expander").length&&(u.topbar.topbar.removeClass("topbar--fixed"),u.win.on("scroll.elementfixed",function(){var e=u.win.scrollTop()-m.offset().top+40>=0;u.topbar.topbar.toggleClass("topbar--fixed",e)})),u.win.on("resize",function(){C=u.win.width()-1024>=0?"large":"small"})}},r=function(){var a=this,n=u.topbar.notification,o=n.find(".topbar__notification__counter"),r=n.find(".topbar__dropdown-lists"),s=n.find(".topbar__flip"),c=n.find(".topbar__notification__msglists"),l=parseFloat(c.css("min-height"),10),d=parseFloat(c.css("max-height"),10),p=150+d,m=6e4,f=60*m,g=24*f;this.transTime=function(e){var t=new Date(e);return{Y:t.getYear(),M:t.getMonth()+1,D:t.getDate(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds()}},this.formatTime=function(e,t){var n,i,o,r=e-t,s=a.transTime,c=s(t);switch(r/g|0){case 0:o=r/f|0,i=(r/m|0)-60*o,n=1>o?i?i+"分鐘前":"剛剛":o+"小時前";break;case 1:n="昨天"+c.h+":"+c.m;break;default:n=c.M+"月"+c.D+"日"}return n},this.formatMsgDate=function(t){for(var n,i,o,r=e("<ul />"),s=r.html(t).find(".topbar__notification__msglist__time"),c=new Date,l=s.length-1;l>=0;l--)n=new Date(1e3*e(s[l]).text()),i=a.formatTime(c,n),o=n.toLocaleString(),e(s[l]).html(i).attr({title:o}),n=i=null;return t=r.html()},this.ajaxCounter=function(e){if(e)return e===n.data("ajax-counter");var t=n.data("ajax-counter")||0,a=t+1;return n.data("ajax-counter",a),a},this.getData=function(){if(!n.hasClass("ajax-loading")&&!r.hasClass(h)){if(n[0].className=n.data("className"),n.addClass("ajax-loading"),"0"===o.attr("data-counter")&&n.data("latestNotification"))return c.html(a.formatMsgDate(n.data("latestNotification").html)),setTimeout(function(){n.removeClass("ajax-loading")},0),void 0;var t=a.ajaxCounter();e.ajax({url:"/api/notifyentries",dataType:"json"}).done(function(e){e.error?n.addClass("ajax-error"):(n.addClass("ajax-success").data("latestNotification",e),a.ajaxCounter(t)&&e.latestTime!==n.data("latestTime")&&(c.html(a.formatMsgDate(e.html)),n.addClass("ajax-done"),a.latestTime(e.latestTime)),a.counterNum(0))}).fail(function(){n.addClass("ajax-error")}).always(function(){setTimeout(function(){n.removeClass("ajax-loading")},0)})}},this.resize=function(){var e=u.win.height();p>e&&e>l&&c.css("max-height",e-150)},this.latestTime=function(e){return e?(n.data("latestTime",e),void 0):n.data("latestTime")},this.counterNum=function(e){var t,a,n="no-notification";return e===i?o.attr("data-counter"):(e=Number(e),t=o.hasClass(n),a=0===e,a||t?a!==t&&(o.attr("data-counter",e),o.toggleClass(n)):o.attr("data-counter",e),void 0)},this.toggleShowHide=function(){o.on("click",function(e){e.preventDefault(),a.getData(),o.toggleClass(h),r.toggleClass(h),a.resetFlip()}),u.doc.on("click",function(t){var a=t.target,i=e(a).parents().filter(n).length;i||(o.removeClass(h),r.removeClass(h))})},this.resetFlip=function(){s.removeClass("is-flipping")},this.toggleFlip=function(){s.toggleClass("is-flipping")},this.checkUnreadNotiCount=function(){!function i(){t.setTimeout(function(){var o=n.data("latestTime"),r=a.counterNum();e.ajax({url:"/api/getunreadnotifyinfo",type:"GET",dataType:"json",data:{latestTime:o}}).done(function(e){var t=e.unreadNotifyCount;t&&t!==r&&a.counterNum(t)}).fail(function(){t.console&&t.console.log("ajax error: /api/getunreadnotifyinfo")}).always(function(){i()})},6e4)}()},this.init=function(){n.data("className",n[0].className),u.win.on("resize.notification",a.resize),a.toggleShowHide(),n.find(".topbar__notification__list--header__title").on("click",a.toggleFlip),n.find(".topbar__flip--back").on("click",function(e){e.preventDefault(),a.toggleFlip()}),a.checkUnreadNotiCount(),t.setTimeout(function(){u.win.trigger("resize.notification")},0)}},c=function(){var t,n=u.topbar.lang.find(".topbar__lang__lists"),i="/blog/setlocale",o=this;this.sendLang=function(){e.post(i,{locale:t},function(e){e.error||a.location.reload()})},this.init=function(){n.on("click","a",function(){var a=e(this);t=a.data("lang"),o.sendLang()})}},l=function(){var t=u.topbar.searchContainer.find(".topbar__search__toggle-btn");this.init=function(){t.on("click",function(){u.topbar.search.toggle(),t.toggleClass(h)}),u.doc.on("click",function(a){var n=a.target,i=e(n).parents().filter(u.topbar.searchContainer).length;i||(u.topbar.search.toggle(!1),t.toggleClass(h,!1))})}},function(){u.topbar.topbar.addClass(function(){for(var t=[e.support.cssProperty("animation"),e.support.cssProperty("borderRadius"),e.support.cssProperty("boxShadow"),!p],a=["cssanimations","borderradius","boxshadow","cssgradients"],n=t.length-1;n>=0;n--)t[n]||(a[n]="no-"+a[n]);return a.join(" ")}),u.topbar.user.add(u.topbar.lang).find(".topbar__dropdown-btn").on("click",function(e){e.preventDefault()}),n.f.topbar=n.f.topbar||{option:{search:!0,announce:!0,notification:!0,switchlang:!0,searchContainer:!0,relatedArticle:!0}};var t=function(){var e=u.topbar.search;return{jqSearch:e,jqSearchInput:e.find(".topbar__search__input"),jqSearchBtn:e.find(".topbar__search__btns"),jqSearchReset:e.find(".topbar__search__reset"),jqSearchSuggestion:e.find(".topbar__search__suggestion"),suggestionItemTpl:'<li class="topbar__search__suggestion__item">#{$keyword}</li>',suggestionItemClass:"topbar__search__suggestion__item",suggestionShowClass:"topbar__search__suggestion--show",suggestionSelectedClass:"topbar__search__suggestion__item--selected",suggestion:!0,suggestionKeyboard:!0,autoFocusBtn:!1}}(),a={jqAnnounce:u.topbar.announce,hideClass:"topbar__announce__item--hide",duration:6e3};n.f.topbar.search=new e.fn.Search(t),n.f.topbar.announce=new s(a),u.topbar.notification.length&&(n.f.topbar.notification=new r),n.f.topbar.switchlang=new c,u.topbar.searchContainer.length&&(n.f.topbar.searchContainer=new l),u.topbar.relatedArticle.length&&(n.f.topbar.relatedArticle=new d);for(var i in n.f.topbar)n.f.topbar.hasOwnProperty(i)&&"option"!==i&&n.f.topbar.option[i]&&n.f.topbar[i].init()}()}),function(){function n(){t.innerWidth>=1280&&(b.addClass("show-sidebar"),T=!0),_.on("scroll.sidebarshift",function(){if(T){if(k.css("left",-t.pageXOffset),v.hasClass("topbar--fixed")){var e=Math.max(220-t.pageXOffset,0);v.css("left",e)}f&&(C=_.scrollTop()-v.offset().top>=0,k.toggleClass("sidebar--fixed",C),C||v.attr("style",""))}}),_.on("resize.toggleSidebar",function(){!T&&t.innerWidth>=1280?T=!0:T&&t.innerWidth<1280&&(k.attr("style",""),v.attr("style",""),T=!1),b.toggleClass("show-sidebar",T)}),k.on("click",".keyword-tag",function(){for(var t=e(this).index(),a=k.find(".keyword-tag"),n=0;n<a.length;n++)a.eq(n).toggleClass("active",t===n);k.find(".keyword-articles-container").css("margin-left",-220*t+"px"),s(w,"tab imps",e(this).text())}),k.on("click",".keyword-article",function(){var t=e(this).parent().index();s(w,"article clicked",e(".keyword-tag").eq(t).text())}),setTimeout(function(){f=e("#mib-video-expander").length,f&&(C=!1,k.removeClass("sidebar--fixed"))},0)}function i(e){return e.split("//")[1].split("#")[0].split("?")[0].split("-")[0].replace(/.\w+\.test\.pixnet/,"").replace(/.\w+\.alpha\.pixnet/,"")}function o(){var e="; "+a.cookie,t=e.split("; keyword_sidebar=");return 2>t.length?{}:JSON.parse(t[1].split(";")[0])}function r(e,t){var n=o(),i=location.host+location.pathname.split("-")[0];n[i]=e+","+t,a.cookie="keyword_sidebar="+JSON.stringify(n)+";domain=."+location.host.replace(/\w+\./,"")+";path=/"}function s(e,t,a){var n="article clicked"===t,i=y?"標題 + 摘要":"標題";e===w&&(t=i+" "+t),ga("sidebarTracker.send","event",e,t,a,{nonInteraction:!n})}function c(){!function(e,t,a,n,i,o,r){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,o=t.createElement(a),r=t.getElementsByTagName(a)[0],o.async=1,o.src=n,r.parentNode.insertBefore(o,r)}(t,a,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-65168598-14","auto","sidebarTracker"),ga("sidebarTracker.send","pageview"),S&&s("from search","1. sampling")}function l(){var e=o(),t=function(){return a.referrer?i(a.referrer):""}();t&&e[t]&&(m=function(){var a=e[t].split(",");return 2!==a.length?!1:{username:a[0],id:a[1]}}(),A||u())}function d(){m=g,u()}function u(){if(m){e.ajaxSetup({cache:!0});var t=e.ajax({url:"http://emma.pixnet.cc/blogarticles/topkeywords",dataType:"json",data:{user_name:m.username,article_id:m.id}}),a=e.ajax({url:"https://emma.pixnet.cc/blog/articles/"+m.id,dataType:"json",data:{user:m.username}}),n=e.ajax({url:"http://emma.pixnet.cc/blog/articles/"+m.id+"/ypa",dataType:"json",data:{user:m.username,desc:y}});e.ajaxSetup({cache:!1}),e.when(a,t,n).done(function(e,t,a){if(c(),e[0]&&!e[0].error&&t[0]){if(S){if(s("from search","2. in search console"),A)return;s("from search","3. sidebar exist")}h(e[0].article,t[0],a[0])}})}}function p(t){function a(e){return encodeURIComponent(e).replace(/(%[A-F\d]{2}){3}/g,"UU").length}function n(e,t){if(e=e.replace(/\n/g,""),a(e)<=2*t)return e;for(var n=t;n<e.length;n++){var i=e.substr(0,n);if(a(i)>2*t)return e.substr(0,n-1)+"..."}}var o="",r="",c='<span class="keyword-tag {% ACTIVE %}">{% KEYWORD %}</span> ',l=function(){return y?'<a class="keyword-article {% ACTIVE %}" href="{% LINK %}"><h3 class="keyword-article__title">{% TITLE %}</h3><p class="keyword-article__desc">{% SUMMARY %}</p></a>':'<a class="keyword-article keyword-article-min70 {% ACTIVE %}" href="{% LINK %}"><h3 class="keyword-article__title">{% TITLE %}</h3></a>'}(),d=i(location.href),u=function(e,t,a){var o=i(e.url)===d?"active":"";return a&&(e.title=n(e.title,25),e.summary=n(e.summary,50)),l.replace("{% ACTIVE %}",o).replace("{% LINK %}",e.url).replace("{% TITLE %}",e.title).replace("{% SUMMARY %}",e.summary.replace(t,"<span>"+t+"</span>"))};e.each(t.keywordsArticles,function(e,a){var n=o?"":"active";o+=c.replace("{% KEYWORD %}",e).replace("{% ACTIVE %}",n),r+='<div class="keyword-articles">',r+=u(t.topArticle,e,!0);for(var i=0;i<a.length;i++)r+=u(a[i],e),3===i%4&&(r+=t.ypaIframes[(i-3)/4]);r+="</div>"}),k.find(".keyword-tags").html(o),k.find(".keyword-articles-container").html(r).css("top",k.find(".keyword-tags").height()+55),s(w,"tab imps",e(".keyword-tag").eq(0).text())}function h(e,t,a){(!a||a.error)&&(a={ypa:[]}),p({topArticle:{title:e.title,summary:e.body.replace(/<([^>]+)>/g,""),url:e.link},keywordsArticles:t,ypaIframes:a.ypa}),n(),r(m.username,m.id)}var m,f,g=function(){var t=e("meta[name=author]").attr("content").split(" ("),a=t[t.length-1].split(")")[0];return{username:a,id:e("body").data("article-id")}}(),w=g.username+" "+g.id,_=e(t),b=e("body"),k=e(".sidebar"),v=e("#topbar"),y=k.data("type"),T=!1,C=!0,x=!Math.floor(20*Math.random()),A=k.data("obstruct"),S=function(e){return e?e.match(/www\.google\.com/)||e.match(/search\.yahoo\.com/)||e.match(/www\.bing\.com/)||e.match(/www\.pixnet\.net\/searcharticle/)?!0:!1:"search"===k.data("search")}(a.referrer),R=function(){var e=new Date,t=e.getHours(),a=new Date("2016/02/04").getTime();return t>=2&&6>t&&e.getTime()<a}();g&&g.id&&R&&(S||A||l(),S&&x&&d())}()}(jQuery,window,document,pix);
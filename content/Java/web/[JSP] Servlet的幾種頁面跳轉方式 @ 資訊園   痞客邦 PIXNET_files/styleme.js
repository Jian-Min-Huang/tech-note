(function($){"use strict";if(!pix.stylemeTags||!pix.stylemeTags.length){return}var stylemeArticles=[],thisWindow=$(window,document),stickyBox=$(".styleme-stickybox"),articleContainer=stickyBox.find(".styleme-block__articles"),isFirstShow=true,isShowing=false,scrollSlide={currentIdx:0,limit:{min:0,max:3}};$.ajaxSetup({cache:true});for(var i=0;i<pix.stylemeTags.length;i++){$.ajax({url:"https://emma.pixnet.cc/blog/articles",type:"get",dataType:"json",data:{user:"styleme",category_id:pix.stylemeTags[i].cat_id,thumb_size:100,per_page:4}}).done(extendArticles)}$.ajaxSetup({cache:false});thisWindow.load(function(){if(!pix.stylemeArticles){stylemeArticlesInit()}});function getArticleData(articles,num){var articleNum=Math.min(num,articles.length),newArticles=[];for(var i=0;i<articleNum;i++){var rand=Math.floor(Math.random()*(articles.length-1));newArticles.push(formatData(articles[rand]));articles.splice(rand,1)}return newArticles;function formatData(article){return{thumb:article.thumb,title:article.title,url:article.link,author:article.user.display_name||article.user.name,label:article.category}}}function insertArticles(){var bloggerData={username:pix.owner,articleId:$("body").data("article-id")},ulTmpl='<ul class="styleme-block-list">',liTmpl='<li class="styleme-block"><a href="{{ URL }}" target="_blank" data-label="{{ LABEL }}"><img class="styleme-block__image" src="{{ THUMB }}"><span class="styleme-block__text"><span class="styleme-block__title">{{ TITLE }}</span><span class="styleme-block__author">{{ AUTHOR }}</span></span></a></li>';for(var i=0;i<pix.stylemeArticles.length;i++){var article=pix.stylemeArticles[i],params={utm_campaign:"article_to_article",utm_source:"pixnet",utm_medium:"CTA_mobile_"+(i+1),utm_term:article.label,utm_content:bloggerData.username+"/"+bloggerData.articleId};ulTmpl+=liTmpl.replace("{{ URL }}",article.url+"?"+$.param(params)).replace("{{ LABEL }}",article.label).replace("{{ THUMB }}",article.thumb).replace("{{ TITLE }}",article.title).replace("{{ AUTHOR }}",article.author)}articleContainer.append($(ulTmpl+="</ul>"))}function stickyboxShow(){isShowing=!isShowing;stickyBox.toggleClass("show",isShowing);if(!isFirstShow){return}isFirstShow=false;thisWindow.off("scroll.stylemeStickyBox");var articleList=articleContainer.children(".styleme-block-list"),tags=function(){var arr=[];for(var i=0;i<pix.stylemeTags.length;i++){arr.push(pix.stylemeTags[i].oct_tag_name)}return arr.join(", ")}();ga("create","UA-65168598-11","auto","stylemeArticlesTracker");ga("stylemeArticlesTracker.set","contentGroup2",tags);ga("stylemeArticlesTracker.set","contentGroup3","sticky");ga("stylemeArticlesTracker.send","pageview");articleContainer.on("click","a",function(){ga("stylemeArticlesTracker.send","event","styleme related","click sticky",$(this).data("label"))});stickyBox.on("click",".styleme-stickybox__slide-btn",function(){var translateX=scrollSlide.currentIdx,direction=$(this).index(".styleme-stickybox__slide-btn")||-1,gaAction=direction+1?"click more-next":"click more-prev",moveto=getNextIdx(parseInt(translateX+direction,10));ga("stylemeArticlesTracker.send","event","styleme related",gaAction);if(moveto===translateX){return}scrollSlide.currentIdx=moveto;articleList.removeClass("slide-0 slide-1 slide-2 slide-3").addClass("slide-"+moveto);function getNextIdx(index){if(index<scrollSlide.limit.min){return scrollSlide.limit.max}if(index>scrollSlide.limit.max){return scrollSlide.limit.min}return index}})}function extendArticles(data){if(!data.error){stylemeArticles=stylemeArticles.concat(data.articles);if(stylemeArticles.length===pix.stylemeTags.length*4){stylemeArticlesInit()}}}function stylemeArticlesInit(){pix.stylemeArticles=getArticleData(stylemeArticles,4);if(pix.replaceStylemeArticles){pix.replaceStylemeArticles()}if(!stickyBox.length){return}if(!pix.stylemeArticles.length){stickyBox.remove();return}insertArticles();stickyBox.addClass("live");thisWindow.on("scroll.stylemeStickyBox",function(){if(1e3<thisWindow.scrollTop()){stickyboxShow()}});stickyBox.on("click",".styleme-stickybox__header",function(){stickyboxShow();ga("stylemeArticlesTracker.send","event","styleme related","click headlines-open")});stickyBox.on("click",".styleme-stickybox__toggle-btn",function(){stickyboxShow();var gaAction=isShowing?"click button-open":"click button-close";ga("stylemeArticlesTracker.send","event","styleme related",gaAction)})}})(jQuery);

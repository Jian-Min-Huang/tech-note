!function(e,s){function t(){var s=function(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null},t=function(e){return Object.keys(e).map(function(s){return e[s]}).join(" ")};this.initializeUI=function(){if(this.bsn=Number(s("bsn")),this.searchTerm={},this.searchTerm.bsn="more:pagemap:thread-bsn:"+this.bsn,this.searchTerm.filename="more:pagemap:thread-filename:C",this.searchBoxRender(),this.resetGoogleStyle(),this.keywordsRender(),google.search.cse.element.getElement("forumSearch").prefillQuery(s("forumSearchQuery")),e.cookie("ckFORUM_stype")&&e.cookie("ckFORUM_sval")||useOldSearch){e("#searchbox").hide(),e("#old_search_searchbox").show();var t;switch(e.cookie("ckFORUM_stype")){case"M":t="找M文";break;case"author":t="找作者";break;default:t="找標題"}e("#old_search_input").attr("placeholder",t)}},this.searchBoxRender=function(){google.search.cse.element.render({div:"searchbox",attributes:{autoCompleteMaxCompletions:5,autoCompleteMatchType:"any",resultsUrl:"https://forum.gamer.com.tw/search.php?bsn="+this.bsn,queryParameterName:"forumSearchQuery",gaCategoryParameter:this.bsn,gaQueryParameter:"forumSearchQuery",enableHistory:!0},tag:"searchbox-only",gname:"forumSearch"})},this.searchResultsRender=function(e){google.search.cse.element.render({div:"searchresults",attributes:{webSearchQueryAddition:t(this.searchTerm),linkTarget:"_blank",queryParameterName:"forumSearchQuery",gaCategoryParameter:this.bsn,gaQueryParameter:"forumSearchQuery",filters:1,enableOrderBy:e},tag:"searchresults-only",gname:"forumSearch"})},this.searchResultsReload=function(s,t){e("#searchresults").empty(),this.searchResultsRender(s),t&&google.search.cse.element.getElement("forumSearch").execute(t)},this.resetGoogleStyle=function(){e('link[href*="default"]').remove(),e('link[href*="search.css"]').remove();var s=e(".gcse-bar"),t=e("#gsc-i-id1"),a=e(".gcse-option-control"),r=e(".gcse-tab-child");s.on("mouseenter",function(){e(".gcse-option, .gsc-input-box").addClass("is-hover")}).on("mouseleave",function(){e(".gcse-dropdown").hasClass("is-active")||(e(".gcse-option, .gsc-input-box").removeClass("is-hover"),a.removeClass("is-active"))}),t.on("focus",function(){e(".gcse-suggest").addClass("is-active")}).on("blur",function(){0==e(".gcse-dropdown:hover").length&&e(".gcse-dropdown").removeClass("is-active"),e(".gsc-input-box").removeClass("is-focus").removeClass("is-hover")}).on("mouseenter",function(){e(this).is(":focus")&&!e(".gcse-suggest").hasClass("is-active")&&e(".gcse-suggest").addClass("is-active")}).attr("placeholder","輸入 1 或多字元來找文章…"),e("input.gsc-input").on("focus",function(){e(".gsc-input-box, .gcse-option").addClass("is-focus")}).on("blur",function(){e(".gsc-input-box").removeClass("is-focus")}),a.on("click",function(){e(".gcse-sort").addClass("is-active"),e(this).addClass("is-active"),e(".gcse-suggest").removeClass("is-active")}).on("blur",function(){a.removeClass("is-active"),0==e(".gcse-dropdown:hover").length&&e(".gcse-dropdown").removeClass("is-active")}),e(".gcse-sort > ul > li").on("click",function(){e(".gcse-sort").removeClass("is-active");var s=e(".gcse-dropdown > ul > li").index(e(this));if(3==s)e("#old_search_searchbox").hide(),e("#gsc-i-id1").val(e("#old_search_input").val()),e("#searchbox").show(),e("#gsc-i-id1").focus();else switch(e("#searchbox").hide(),e("#old_search_input").val(e("#gsc-i-id1").val()),e("#old_search_searchbox").show(),e("#old_search_input").attr("placeholder",e(this).find(".gcse-sort-title").text()).focus(),s){case 1:e("#stype").val(2);break;case 2:e("#stype").val(4);break;default:e("#stype").val(1)}}),e("#gsc-i-id1").keyup(function(s){e(this).val().length>0?e(".gcse-option-control, .gcse-suggest").removeClass("is-active"):e(".gcse-suggest").addClass("is-active")}),e("#old_search_form").submit(function(){return e("#old_search_input").val().length<1?(alert("請輸入搜尋內容"),!1):void(ga&&ga("send",{hitType:"event",eventCategory:"互動",eventAction:"哈啦區",eventLabel:"桌面搜尋",useBeacon:!0}))});var i=this;r.on("click",function(){r.removeClass("is-active"),e(this).addClass("is-active"),i.changeArea(e(this).attr("id"))})},this.saveRecentSearch=function(){var s=google.search.cse.element.getElement("forumSearch").getInputQuery();if("undefined"!=typeof Storage&&s){var t=JSON.parse(localStorage.getItem("forumSearch"));t=t?t:{},t[this.bsn]=t[this.bsn]?t[this.bsn]:[],t[this.bsn].unshift(s),e.unique(t[this.bsn]),t[this.bsn]=t[this.bsn].slice(0,15),localStorage.setItem("forumSearch",JSON.stringify(t))}},this.keywordsRender=function(){function s(s,t,a,r,i){if(t.length){var o=e("<div>").addClass(a);for(var c in t)o.append('<a href="search.php?bsn='+i+"&forumSearchQuery="+t[c]+'">'+t[c]+"</a>");r.append("<h3>"+s+"</h3>").append(o)}}var t=[];if("undefined"!=typeof Storage){var a=JSON.parse(localStorage.getItem("forumSearch"));null!=a&&null!=a[this.bsn]&&(t=a[this.bsn])}hotKeywords.length||t.length?(s("最近搜尋",t,"search-suggest-tag",e(".right-child"),this.bsn),s("最近搜尋",t,"gcse-suggest-tag",e("#gcse-suggest-child-recently"),this.bsn),s("熱門搜尋",hotKeywords,"search-suggest-tag",e(".right-child"),this.bsn),s("熱門搜尋",hotKeywords,"gcse-suggest-tag",e("#gcse-suggest-child-hot"),this.bsn)):e(".search-suggest, .gcse-suggest").hide()},this.changeCondition=function(){this.searchTerm.bsn="more:pagemap:thread-bsn:"+this.bsn,this.searchTerm.filename="more:pagemap:thread-filename:C",this.searchTerm.subbsn=e("#filter-subbsn").val()?"more:pagemap:thread-subbsn:"+e("#filter-subbsn").val():"",this.searchTerm.type="",e("#filter-article").is(":checked")&&(this.searchTerm.type="more:pagemap:thread-extract:T"),e("#filter-author").is(":checked")&&(this.searchTerm.type="more:pagemap:thread-author:"+e("#gsc-i-id1").val(),this.searchTerm.filename="more:pagemap:thread-filename:Co"),this.searchResultsReload(!0)},this.changeArea=function(t){var a=s("forumSearchQuery");switch(this.searchTerm={},t){case"area_board":e(".gcse-forum").hide(),this.searchTerm.filename="more:pagemap:thread-filename:A",a&&this.searchResultsReload(!1,a);break;case"area_others":e(".gcse-forum").hide(),a&&this.searchResultsReload(!1,a+" "+e(".BH-menuE li:nth-child(2)").text()+" -site:forum.gamer.com.tw");break;default:e(".gcse-forum").show(),this.searchTerm.bsn="more:pagemap:thread-bsn:"+this.bsn,this.searchTerm.filename="more:pagemap:thread-filename:C",a&&this.searchResultsReload(!0,a)}}}if(s.forumSearch=new t,!e.cookie("ckFORUM_searchHint")){e.cookie("ckFORUM_searchHint",!0,{domain:"forum.gamer.com.tw",path:"/",expires:7300});var a=new EnjoyHint({}),r=[{"next .TOP-search":'<div align="left" style="line-height:150%">板上搜尋功能搬到這裡囉！<br>快召喚 google 大神，輸入 <span style="color:#5fa8b9">1 個</span> 或 <span style="color:#5fa8b9">多個字串</span> 來幫你搜尋板上文章。</div>',showSkip:!1,nextButton:{text:" 我知道了"}}];a.set(r),a.run()}}(jQuery,window),window.__gcse={parsetags:"explicit",callback:function(){"complete"==document.readyState?forumSearch.initializeUI():google.setOnLoadCallback(function(){forumSearch.initializeUI()},!0)}};